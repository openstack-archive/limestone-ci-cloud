---

- job:
    name: limestone-ci-deploy
    description: >-
      Run openstack-ansible to deploy the Limestone Networks
      CI cloud
    pre-run: zuul.d/playbooks-deploy/pre.yml
    run: zuul.d/playbooks-deploy/run.yml
    post-run: zuul.d/playbooks-deploy/post.yml
    timeout: 10800
    allowed-projects:
      - openstack/limestone-ci-cloud
    vars:
      vault_key_path: "{{ ansible_user_dir }}/.vault"
      ssh_agent_sock: "{{ ansible_user_dir }}/.ssh-agent.sock"
      lsn_ci_src_path: "{{ ansible_user_dir }}/{{ (zuul.projects | dictsort | selectattr('1.short_name', 'equalto', 'limestone-ci-cloud') | list | first).1.src_dir }}"
    secrets:
      - name: ssh_key_secret
        secret: limestone_ci_ssh_key
      - name: vault_secret
        secret: limestone_ci_vault
    nodeset: ubuntu-bionic
